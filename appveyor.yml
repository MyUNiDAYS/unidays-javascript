
#------ tests configuration ------#
environment:
  matrix:
    - nodejs_version: '8'
    - nodejs_version: '6'
install:
  - npm install
  - ps: '"//registry.npmjs.org/:_authToken=$env:npm_token`n" | out-file "$env:userprofile\.npmrc" -Encoding ASCII'
  - npm whoami
test_script:
  - npm test
build: off
#---- deployment configuration ----#

branches:
  only:
    - master
    deploy:
  - npm pack
  - npm publish
    on:
      branch: master


# master
-
  branches:
    only:
      - master
      
  skip_tags: true

  version: 1.0.{build}-{branch}
   
  init:
    - git config --global core.autocrlf true
  
  environment:
  matrix:
    - nodejs_version: '8'
  
  install:
    - npm install
    - ps: '"//registry.npmjs.org/:_authToken=$env:npm_auth_token`n" | out-file "$env:userprofile\.npmrc" -Encoding ASCII'
    - npm whoami

  build_script:
    - npm run build
    
  test: off

  deploy:
    - provider: Environment
   
  on_failure:
    - ps: Update-AppveyorBuild -Version "$($env:appveyor_build_version)-fail-$(Get-Date -format dd_mm_yyyy_HH_mm_ss)"

  on_success:
    - npm publish --access restricted

# everything except master
-
  branches:
    except:
      - master
      
  skip_tags: true

  version: 0.12.2.{build}-{branch}
   
  init:
    - git config --global core.autocrlf input
  
  environment:
  matrix:
    - nodejs_version: '8'
    - nodejs_version: '6'

  install:
    - npm install
    - ps: '"//registry.npmjs.org/:_authToken=$env:npm_auth_token`n" | out-file "$env:userprofile\.npmrc" -Encoding ASCII'
    - npm whoami

  build_script:
    - npm run build
    
  test_script:
    - npm test
   
  on_failure:
    - ps: Update-AppveyorBuild -Version "$($env:appveyor_build_version)-fail-$(Get-Date -format dd_mm_yyyy_HH_mm_ss)"